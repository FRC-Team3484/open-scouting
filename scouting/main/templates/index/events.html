{% load static %}

<script src="{% static '/main/scripts/index/events.js' %}"></script>
<script src="{% static '/main/scripts/index/favorite_toggle.js' %}"></script>

<div class="flex flex-col justify-center items-center dark:bg-slate-800/50 bg-slate-200/50 rounded-2xl p-4 border-2 dark:border-slate-700 border-slate-300 my-2"
     x-data="events"
     x-show="page == 3"
     x-transition>
    <p class="text-center dark:text-white text-black font-sans text-2xl my-4">
        <i class="ph-bold ph-calendar-blank"></i>{% translate "Select event" %}</p>

    <div class="my-4">
        <div class="flex flex-row flex-wrap gap-2 mb-2">
            <button class="ui_button_small"
                    :disabled="active_tab === 'tba'"
                    @click="active_tab = 'tba'">
                <i class="ph-bold ph-check-circle"></i>
                <span class="dark:text-white text-black text-sm md:text-md">{% translate "TBA Events" %}</span>
                <span class="dark:text-white text-black bg-slate-200 dark:bg-slate-600 py-1 px-2 rounded-full border-slate-300 dark:border-slate-700 max-w-4 aspect-square my-2 text-sm border-2"
                      x-text="filtered_events.length"></span>
            </button>

            <button class="ui_button_small"
                    :disabled="active_tab === 'custom'"
                    @click="active_tab = 'custom'">
                <i class="ph-bold ph-pencil"></i>
                <span class="dark:text-white text-black text-sm md:text-md">{% translate "Custom Events" %}</span>
                <span class="dark:text-white text-black bg-slate-200 dark:bg-slate-600 py-1 px-2 rounded-full border-slate-300 dark:border-slate-700 max-w-4 aspect-square my-2 text-sm border-2"
                      x-text="custom_filtered_events.length"></span>
            </button>

            <template x-if="authenticated">
                <button class="ui_button_small"
                        :disabled="active_tab === 'favorites'"
                        @click="active_tab = 'favorites'">
                    <i class="ph-bold ph-star"></i>
                    <span class="dark:text-white text-black text-sm md:text-md">{% translate "Favorites" %}</span>
                    <span class="dark:text-white text-black bg-slate-200 dark:bg-slate-600 py-1 px-2 rounded-full border-slate-300 dark:border-slate-700 max-w-4 aspect-square my-2 text-sm border-2"
                          x-text="favorite_filtered_events.length"></span>
                </button>
            </template>

            <div class="flex flex-row mt-2 justify-center align-middle items-center">
                <input class="ui_checkbox"
                       type="checkbox"
                       x-ref="show_past_events"
                       @input="update_filters()">
                <p class="dark:text-white text-black ml-2">{% translate "Show past events" %}</p>
            </div>

        </div>

        <input class="ui_input !w-full"
               placeholder="{% translate "Search for an event..." %}"
               x-ref="event_search"
               @input="update_filters()">

        <div class="h-[50vh] overflow-y-auto dark:bg-slate-700 bg-slate-200 dark:border-slate-600 border-slate-300 border-1 mx-2 p-2 rounded-md mt-2">
            <div x-show="active_tab === 'tba'">
                <template x-for="event in filtered_events" :key="event.event_code">
                    <div class="p-2 dark:bg-slate-800 border-2 dark:border-slate-700 bg-slate-300 border-slate-400 m-1 rounded-lg flex flex-row justify-between hover:dark:bg-slate-900/80 hover:bg-slate-200/80 cursor-pointer transition-all"
                         @click="select_event(event.name, event.event_code)">
                        <div class="flex flex-col">
                            <p class="dark:text-white text-black font-sans" x-text="event.name"></p>
                            <div class="flex flex-row">
                                <p class="dark:text-white text-black font-sans font-bold text-sm"
                                   x-text="event.event_type_string"></p>
                                <p class="dark:text-white text-black font-sans text-sm mx-1">-</p>
                                <p class="dark:text-white text-black font-sans text-sm"
                                   x-text="event.city"></p>
                                <p class="dark:text-white text-black font-sans text-sm mr-1">,</p>
                                <p class="dark:text-white text-black font-sans text-sm"
                                   x-text="event.country"></p>
                            </div>
                            <div class="flex flex-row">
                                <p class="dark:text-white text-black font-sans font-light"
                                   x-text="event.start_date"></p>
                                <p class="dark:text-white text-black font-sans font-light mx-1">-</p>
                                <p class="dark:text-white text-black font-sans font-light"
                                   x-text="event.end_date"></p>
                            </div>
                        </div>

                        <template x-if="authenticated">
                            <div x-data="favorite_toggle"
                                 x-init="init()"
                                 :data-event-code="event.event_code">
                                <button class="text-lg dark:text-white text-black opacity-50 hover:opacity-80 mr-2 transition-all"
                                        x-show="!loading && !isFavorite"
                                        @click.stop="toggleFavorite">
                                    <i class="ph-bold ph-star"></i>
                                </button>
                                <button class="text-lg dark:text-white text-black opacity-50 hover:opacity-80 mr-2 transition-all"
                                        x-show="!loading && isFavorite"
                                        @click.stop="toggleFavorite">
                                    <i class="ph-fill ph-star"></i>
                                </button>
                            </div>
                        </template>
                    </div>
                </template>

                <p class="dark:text-white text-black text-center text-lg"
                   x-show="no_events && !loading"
                   x-transition>
                    <i class="ph-bold ph-smiley-sad"></i>{% translate "No events found" %}</p>

                <p class="dark:text-white text-black text-center text-lg"
                   x-show="loading"
                   x-transition>
                    <i class="ph-bold ph-circle-notch !animate-spin origin-center"></i>{% translate "Loading events..." %}</p>

                <button class="ui_button w-full" @click="create_custom_event()">
                    <i class="ph-bold ph-plus"></i>{% translate "Create a custom Event" %}</button>
            </div>

            <div x-show="active_tab === 'custom'">
                <template x-for="event in custom_filtered_events" :key="event.event_code">
                    <div class="p-2 dark:bg-slate-800 border-2 dark:border-slate-700 bg-slate-300 border-slate-400 m-1 rounded-lg flex flex-row justify-between hover:dark:bg-slate-900/80 hover:bg-slate-200/80 cursor-pointer transition-all"
                         @click="select_event(event.name, event.event_code)">
                        <div class="flex flex-col">
                            <p class="dark:text-white text-black font-sans" x-text="event.name"></p>
                            <div class="flex flex-row">
                                <p class="dark:text-white text-black font-sans font-bold text-sm"
                                   x-text="event.event_type_string || event.type || 'Custom Event'"></p>
                                <p class="dark:text-white text-black font-sans text-sm mx-1">-</p>
                                <p class="dark:text-white text-black font-sans text-sm"
                                   x-text="event.city || event.location"></p>
                            </div>
                            <div class="flex flex-row">
                                <p class="dark:text-white text-black font-sans font-light"
                                   x-text="event.start_date"></p>
                                <p class="dark:text-white text-black font-sans font-light mx-1">-</p>
                                <p class="dark:text-white text-black font-sans font-light"
                                   x-text="event.end_date"></p>
                            </div>
                        </div>
                    </div>
                </template>

                <p class="dark:text-white text-black text-center text-lg"
                   x-show="custom_filtered_events.length === 0 && !loading"
                   x-transition>
                    <i class="ph-bold ph-smiley-sad"></i>{% translate "No events found" %}</p>

                <p class="dark:text-white text-black text-center text-lg"
                   x-show="loading"
                   x-transition>
                    <i class="ph-bold ph-circle-notch !animate-spin origin-center"></i>{% translate "Loading events..." %}</p>

                <button class="ui_button w-full" @click="create_custom_event()">
                    <i class="ph-bold ph-plus"></i>{% translate "Create a custom Event" %}</button>
            </div>

            <div x-show="active_tab === 'favorites'">
                <template x-for="event in favorite_filtered_events"
                          :key="event.event_code || event.name">

                    <div class="p-2 dark:bg-slate-800 border-2 dark:border-slate-700 bg-slate-300 border-slate-400 m-1 rounded-lg flex flex-row justify-between hover:dark:bg-slate-900/80 hover:bg-slate-200/80 cursor-pointer transition-all"
                         @click="select_event(event.name, event.event_code)">
                        <div class="flex flex-col">
                            <p class="dark:text-white text-black font-sans" x-text="event.name"></p>
                            <div class="flex flex-row">
                                <p class="dark:text-white text-black font-sans font-bold text-sm"
                                   x-text="event.event_type_string || event.type || 'Custom Event'"></p>
                                <p class="dark:text-white text-black font-sans text-sm mx-1">-</p>
                                <p class="dark:text-white text-black font-sans text-sm"
                                   x-text="event.city || event.location"></p>
                            </div>
                            <div class="flex flex-row">
                                <p class="dark:text-white text-black font-sans font-light"
                                   x-text="event.start_date"></p>
                                <p class="dark:text-white text-black font-sans font-light mx-1">-</p>
                                <p class="dark:text-white text-black font-sans font-light"
                                   x-text="event.end_date"></p>
                            </div>
                        </div>

                        <template x-if="authenticated">

                            <div x-data="favorite_toggle"
                                 x-init="init()"
                                 :data-event-code="event.event_code">
                                <button class="text-lg dark:text-white text-black opacity-50 hover:opacity-80 mr-2 transition-all"
                                        x-show="!loading && !isFavorite"
                                        @click.stop="toggleFavorite">
                                    <i class="ph-bold ph-star"></i>
                                </button>
                                <button class="text-lg dark:text-white text-black opacity-50 hover:opacity-80 mr-2 transition-all"
                                        x-show="!loading && isFavorite"
                                        @click.stop="toggleFavorite">
                                    <i class="ph-fill ph-star"></i>
                                </button>
                            </div>
                        </template>

                    </div>
                </template>

                <p class="dark:text-white text-black text-center text-lg"
                   x-show="favorite_filtered_events.length === 0 && !loading"
                   x-transition>
                    <i class="ph-bold ph-smiley-sad"></i>{% translate "No favorite events" %}</p>

                <p class="dark:text-white text-black text-center text-lg"
                   x-show="loading"
                   x-transition>
                    <i class="ph-bold ph-circle-notch !animate-spin origin-center"></i>{% translate "Loading events..." %}</p>
            </div>

        </div>
    </div>

</div>
