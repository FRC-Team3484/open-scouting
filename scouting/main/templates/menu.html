<div x-data="menu()">
    <div class="flex flex-row fixed bottom-2 right-2 justify-end w-auto items-center">
        <div x-show="notification_shown && !open"
             class="mx-4 w-full md:bottom-4 md:right-4 text-white text-md md:text-3xl p-1 md:p-2 dark:bg-slate-700/80 border-2 dark:border-slate-600 bg-slate-200/80 border-slate-300 rounded-full backdrop-blur-md"
             x-transition>
            <div class="flex flex-row items-center justify-between">
                <div class="flex flex-row dark:text-white text-black ml-2 items-center text-xl">
                    <i :class="notification.icon_class"></i>

                    <div class="flex flex-col ml-2">
                        <p class="text-sm font-bold" x-text="notification.title"></p>
                        <p class="text-sm" x-text="notification.body"></p>
                    </div>
                </div>

                <button class="ui_button_icon" @click="hide_notification()">
                    <i class="ph-bold ph-x"></i>
                </button>
            </div>
        </div>

        <div class="md:bottom-4 md:right-4 dark:text-white text-black text-xl md:text-3xl p-1 md:p-2 dark:bg-slate-700/80 border-2 dark:border-slate-600 bg-slate-200/80 border-slate-300 rounded-full backdrop-blur-md hover:scale-110 active:scale-95 transition-all w-10 h-10 md:w-16 md:h-16 flex flex-row items-center justify-center"
             x-show="!open"
             @click="open = true"
             t-transition>
            <i class="ph-bold ph-list"></i>
        </div>
    </div>

    <div x-show="notification_shown && open"
         class="w-full fixed top-2 z-10 text-white text-md md:text-3xl p-1 md:p-2 dark:bg-slate-700/80 border-2 dark:border-slate-600 bg-slate-200/80 border-slate-300 rounded-full backdrop-blur-md"
         x-transition>
        <div class="flex flex-row items-center justify-between">
            <div class="flex flex-row dark:text-white text-black ml-2 items-center text-xl">
                <i :class="notification.icon_class"></i>

                <div class="flex flex-col ml-2">
                    <p class="text-sm font-bold" x-text="notification.title"></p>
                    <p class="text-sm" x-text="notification.body"></p>
                </div>
            </div>

            <button class="ui_button_icon" @click="hide_notification()">
                <i class="ph-bold ph-x"></i>
            </button>
        </div>
    </div>

    <div x-show="open"
         x-transition
         class="flex flex-col fixed bottom-0 z-10 inset-x-0 mx-auto bg-slate-200/80 dark:bg-slate-700/80 border-2 dark:border-slate-600 border-slate-300 rounded-t-2xl backdrop-blur-md w-screen md:w-3/4 lg:w-1/2 h-3/4 md:min-h-1/2 overflow-y-auto p-4"
         x-transition>
        <div class="flex flex-row justify-between items-center w-full border-b-2 dark:border-slate-600 border-slate-300 px-6 py-4">
            <div class="flex flex-row">
                <div class="flex flex-row dark:text-white text-black items-center text-xl font-bold"
                     x-data="menu_clock()">
                    <i class="ph-bold ph-clock mr-1"></i>
                    <p x-text="hour"></p>
                    <p class="animate-pulse">:</p>
                    <p x-text="minute"></p>
                </div>

                <script>
                    function menu_clock() {
                        return {
                            hour: 0,
                            minute: 0,
    
                            update_time() {
                                let now = new Date();
                                this.hour = now.toLocaleTimeString('en-US', { hour: '2-digit', hour12: true }).split(':')[0].replace(" PM", "").replace(" AM", "");
                                this.minute = now.getMinutes() < 10 ? '0' + now.getMinutes() : now.getMinutes();

                                return now;
                            },
    
                            init() {    
                                let seconds_until_next_minute = 60 - this.update_time().getSeconds();
                                setTimeout(() => {
                                    this.update_time();
    
                                    setInterval(() => {
                                        this.update_time();
                                    }, 60000);
                                }, seconds_until_next_minute * 1000);
                            }
                        }
                    }
                </script>

                <div class="flex flex-row items-center dark:text-white text-black text-md mx-1 ml-2">
                    <i class="ph-bold ph-wifi-high" x-show="!offline"></i>
                    <i class="ph-bold ph-wifi-slash" x-show="offline"></i>
                </div>
            </div>

            <button class="ui_button_icon" @click="open = false">
                <i class="ph-bold ph-x"></i>
            </button>
        </div>

        <div class="grid-cols-2 grid gap-x-2 gap-y-2 pt-6">
            <button class="dark:text-white text-black dark:bg-slate-700/80 bg-slate-200/80 backdrop-blur-md dark:border-slate-600 border-slate-300 border-2 rounded-lg py-4 hover:scale-105 active:scale-95 active:dark:bg-slate-800/60 active:bg-slate-300 transition-all hover:bg-slate-100 hover:dark:bg-slate-600 text-center text-md"
                    @click="toggle_dark_mode()">
                <i class="ph-bold ph-moon" x-show="dark_mode" x-transition></i> <i class="ph-bold ph-sun" x-show="!dark_mode" x-transition></i>
                <p x-show="dark_mode">Light Mode</p>
                <p x-show="!dark_mode">Dark Mode</p>
            </button>
            <button class="dark:text-white text-black dark:bg-slate-700/80 bg-slate-200/80 backdrop-blur-md dark:border-slate-600 border-slate-300 border-2 rounded-lg py-4 hover:scale-105 active:scale-95 active:dark:bg-slate-800/60 active:bg-slate-300 transition-all hover:bg-slate-100 hover:dark:bg-slate-600 text-center text-md"
                    @click="toggle_offline_manual()">
                <i class="ph-bold ph-wifi-slash" x-show="offline_manual" x-transition></i> <i class="ph-bold ph-wifi-high" x-show="!offline_manual" x-transition></i>
                <p x-show="offline_manual">Go Online</p>
                <p x-show="!offline_manual">Go Offline</p>
            </button>
        </div>

        <div class="grid-cols-2 grid gap-x-2 gap-y-2 pt-6">
            <a href="{{ SERVER_IP }}"
               class="dark:text-white text-black dark:bg-slate-700/80 bg-slate-200/80 backdrop-blur-md dark:border-slate-600 border-slate-300 border-2 rounded-lg py-4 hover:scale-105 active:scale-95 active:dark:bg-slate-800/60 active:bg-slate-300 transition-all hover:bg-slate-100 hover:dark:bg-slate-600 text-center text-md"><i class="ph-bold ph-house"></i> Home</a>
            <!-- TODO: Update these links when repo moves -->
            <a href="https://github.com/nfoert/open-scouting"
               class="dark:text-white text-black dark:bg-slate-700/80 bg-slate-200/80 backdrop-blur-md dark:border-slate-600 border-slate-300 border-2 rounded-lg py-4 hover:scale-105 active:scale-95 active:dark:bg-slate-800/60 active:bg-slate-300 transition-all hover:bg-slate-100 hover:dark:bg-slate-600 text-center text-md"><i class="ph-bold ph-github-logo"></i> Source Code</a>
            <a href="https://github.com/nfoert/open-scouting/releases"
               class="dark:text-white text-black dark:bg-slate-700/80 bg-slate-200/80 backdrop-blur-md dark:border-slate-600 border-slate-300 border-2 rounded-lg py-4 hover:scale-105 active:scale-95 active:dark:bg-slate-800/60 active:bg-slate-300 transition-all hover:bg-slate-100 hover:dark:bg-slate-600 text-center text-md"><i class="ph-bold ph-notebook"></i> Changelog</a>
            <a href="https://github.com/nfoert/open-scouting/issues"
               class="dark:text-white text-black dark:bg-slate-700/80 bg-slate-200/80 backdrop-blur-md dark:border-slate-600 border-slate-300 border-2 rounded-lg py-4 hover:scale-105 active:scale-95 active:dark:bg-slate-800/60 active:bg-slate-300 transition-all hover:bg-slate-100 hover:dark:bg-slate-600 text-center text-md"><i class="ph-bold ph-bug"></i> Report a Bug</a>
        </div>

        <div x-show="offline_reports"
             class="flex flex-col mt-6 px-6 w-full bg-orange-200/50 dark:bg-orange-800/50 backdrop-blur-md dark:border-orange-700 border-orange-300 border-2 rounded-lg py-4"
             x-transition>
            <div class="flex flex-row">
                <i class="ph-bold ph-cloud-arrow-up dark:text-white text-black text-4xl mr-2"></i>
                <div class="flex flex-col">
                    <p class="dark:text-white text-black text-lg text-sans font-bold">Upload scouting reports</p>
                    <p class="dark:text-white text-black text-md text-sans">
                        While you were offline, some reports were saved locally. You should upload them to ensure that they've been saved to the server.
                    </p>
                </div>
            </div>

            <button class="ui_button" @click="upload_offline_reports()">
                <i class="ph-bold ph-cloud-arrow-up"></i> Upload
            </button>
        </div>

        <div class="flex flex-col pt-6 w-full">
            <button class="dark:text-white text-black dark:bg-slate-700/80 bg-slate-200/80 backdrop-blur-md dark:border-slate-600 border-slate-300 border-2 rounded-lg py-4 hover:scale-105 active:scale-95 active:dark:bg-slate-800/60 active:bg-slate-300 transition-all hover:bg-slate-100 hover:dark:bg-slate-600 text-center text-md"
                    @click="mrbc_open = true">
                <i class="ph-bold ph-seal-check"></i> Check Backed Up Scouting Reports
            </button>
        </div>

        <div class="flex flex-col pt-6 w-full">
            <button @click="credits_open = !credits_open"
                    class="dark:text-white text-black dark:bg-slate-700/80 bg-slate-200/80 backdrop-blur-md dark:border-slate-600 border-slate-300 border-2 rounded-lg py-4 hover:scale-105 active:scale-95 active:dark:bg-slate-800/60 active:bg-slate-300 transition-all hover:bg-slate-100 hover:dark:bg-slate-600 text-center text-md w-full">
                <i x-show="!credits_open" class="ph-bold ph-heart"></i> <i x-show="credits_open" class="ph-bold ph-x"></i> Credits
            </button>

            <div x-show="credits_open" x-collapse class="mx-6">
                <p class="dark:text-white text-black text-md pt-2">
                    Powered by <a href="https://www.thebluealliance.com"
    class="dark:text-blue-400 text-blue-600 hover:dark:text-blue-500 hover:text-blue-700 transition-colors">The Blue Alliance</a>
                </p>
            </div>
        </div>

        <div class="flex flex-col pt-6 w-full">
            <button @click="developer_open = !developer_open"
                    class="dark:text-white text-black dark:bg-slate-700/80 bg-slate-200/80 backdrop-blur-md dark:border-slate-600 border-slate-300 border-2 rounded-lg py-4 hover:scale-105 active:scale-95 active:dark:bg-slate-800/60 active:bg-slate-300 transition-all hover:bg-slate-100 hover:dark:bg-slate-600 text-center text-md w-full">
                <i x-show="!developer_open" class="ph-bold ph-bug"></i> <i x-show="developer_open" class="ph-bold ph-x"></i> Developer Settings
            </button>

            <div x-show="developer_open"
                 x-collapse
                 class="grid=cols-2 grid gap-x-2 gap-y-2 pt-6 mx-6">
                <button class="dark:text-white text-black dark:bg-slate-700/80 bg-slate-200/80 backdrop-blur-md dark:border-slate-600 border-slate-300 border-2 rounded-lg py-4 hover:scale-105 active:scale-95 active:dark:bg-slate-800/60 active:bg-slate-300 transition-all hover:bg-slate-100 hover:dark:bg-slate-600 text-center text-md"
                        @click="clear_service_worker_cache()">Clear service worker cache</button>
                <button class="dark:text-white text-black dark:bg-slate-700/80 bg-slate-200/80 backdrop-blur-md dark:border-slate-600 border-slate-300 border-2 rounded-lg py-4 hover:scale-105 active:scale-95 active:dark:bg-slate-800/60 active:bg-slate-300 transition-all hover:bg-slate-100 hover:dark:bg-slate-600 text-center text-md"
                        @click="toggle_service_worker_mode()"
                        x-show="service_worker_cache_first">Network-first service worker</button>
                <button class="dark:text-white text-black dark:bg-slate-700/80 bg-slate-200/80 backdrop-blur-md dark:border-slate-600 border-slate-300 border-2 rounded-lg py-4 hover:scale-105 active:scale-95 active:dark:bg-slate-800/60 active:bg-slate-300 transition-all hover:bg-slate-100 hover:dark:bg-slate-600 text-center text-md"
                        @click="toggle_service_worker_mode()"
                        x-show="!service_worker_cache_first">Cache-first service worker</button>
            </div>
        </div>
    </div>

    <div x-show="open"
         @click="open = false"
         class="z-5 fixed w-screen h-screen top-0 left-0 bg-black/20 backdrop-blur-lg"
         x-transition:enter="transition-all ease-in-out duration-300"
         x-transition:leave="transition-all ease-in-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"></div>

    <div x-data="menu_report_backup_check()"
         x-show="mrbc_open"
         @click.outside="mrbc_open = false"
         x-transition
         class="flex flex-col fixed bottom-0 z-10 inset-x-0 mx-auto bg-slate-200/80 dark:bg-slate-700/80 border-2 dark:border-slate-600 border-slate-300 rounded-t-2xl backdrop-blur-md w-screen md:w-3/4 lg:w-1/2 h-3/4 md:min-h-1/2 overflow-y-auto p-4"
         x-transition>
        <div class="flex flex-row justify-between items-center w-full border-b-2 dark:border-slate-600 border-slate-300 px-6 py-4 mb-6">
            <div class="flex flex-col">
                <p class="text-black dark:text-white text-2xl font-bold">Check Backed Up Scouting Reports</p>
                <p class="text-black dark:text-white text-sm">
                    Check to ensure that your scouting reports have been saved on the server. Copies are saved locally in case of request or network failure.
                </p>
            </div>

            <button class="ui_button_icon" @click="mrbc_open = false">
                <i class="ph-bold ph-x"></i>
            </button>
        </div>

        <div class="flex flex-row w-full items-center justify-center text-center mb-6">
            <p x-text="locally_backed_up_reports"
               class="dark:text-white text-black text-md font-bold mr-1"></p>
            <p class="dark:text-white text-black font-sans text-md">Checkable reports</p>
        </div>

        <button class="ui_button" @click="check_local_backup_reports()">
            <i class="ph-bold ph-check"></i> Check Reports
        </button>

        <div x-show="backed_up_reports_checked"
             class="flex flex-col items-center justify-center w-full my-2"
             x-collapse>
            <p class="dark:text-white text-black font-bold">
                <i class="ph-bold ph-seal-check"></i> Reports have been checked with the server
            </p>
            <p class="dark:text-white text-black text-sm mb-2">If they were missing, they were automatically uploaded</p>

            <div class="flex flex-row w-full items-center justify-center">
                <p x-text="backed_up_reports_found"
                   class="dark:text-white text-black text-sm font-bold"></p>
                <p class="dark:text-white text-black font-sans text-sm ml-1">Backed up reports found on the server</p>
            </div>

            <div class="flex flex-row w-full items-center justify-center">
                <p x-text="backed_up_reports_not_found"
                   class="dark:text-white text-black text-sm font-bold"></p>
                <p class="dark:text-white text-black font-sans text-sm ml-1">Backed up reports not found on the server</p>
            </div>
        </div>

        <button class="ui_button"
                @click="backed_up_reports_confirm_delete = !backed_up_reports_confirm_delete">
            <i class="ph-bold ph-trash"></i> Clear Saved Reports
        </button>

        <div x-show="backed_up_reports_confirm_delete"
             class="flex flex-row items-center justify-center w-full"
             x-collapse>
            <button class="ui_button mx-2"
                    @click="backed_up_reports_confirm_delete = false">
                <i class="ph-bold ph-x"></i> Cancel
            </button>
            <button class="ui_button mx-2 hover:bg-red-600/80 active:bg-red-700/80"
                    @click="clear_saved_backup_reports()">
                <i class="ph-bold ph-trash"></i> Confirm
            </button>
        </div>
    </div>

    {% include "menu/report_backups.html" %}
</div>

{% include "menu/main.html" %}
